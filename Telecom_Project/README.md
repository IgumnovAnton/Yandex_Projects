# Прогнозирование оттока клиентов для Телеком компании

[Ссылка на nbviewer, если GitHub не прогружает тетрадку](https://nbviewer.org/github/IgumnovAnton/Yandex_Projects/blob/main/Telecom_Project/telecom_project.ipynb)

## **Info**
Оператор связи хочет уметь прогнозировать **отток клиентов**

Основываясь на этих прогнозах, будут предлагаться промокоды и специальные условия клиентам, которые планируют покинуть сервис

Оператор предоставляет два типа услуг:

1. Стационарная телефонная связь. Возможно подключить телефон к нескольким линиям одновременно.
2. Интернет. Подключение возможно двумя способами: DLS (через телефонную линию) или через оптоволоконный кабель


Также доступны такие услуги:
* Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity);
* Выделенная линия технической поддержки (TechSupport);
* Облачное хранилище файлов для резервного копирования данных (OnlineBackup);
* Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies).


За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

**Цель:**
- создать модель прогнозирования оттока клиентов

**Метрика:**
- метрика для оценки качества модели ROC-AUC

**Точность:**
- ROC-AUC лучшей модели должен быть не ниже **0.78**

Для интерпретируемости модели необходимо, для каждой, вывести значение `accuracy`

## **Data**

Данные были предоставленны Яндексом для образовательных целей. 
Данные хранятся в таблицах в базе данных PostgreSQL.

распоряжении оказались 4 таблицы:
- `contract` - информация о договоре (7043 строки и 8 колонок)
- `personal` - персональные данные клиента (7043 строки и 5 колонок)
- `internet` - информация об интернет-услугах (5518 строк и 5 колонок)
- `phone` - информация об услугах телефонии (63262 строки и 2 колонки)

У всех таблиц есть общий ключ для объединения.

Как таковой таргет - отсутствует, но имея дату окончания контракта мы можем воссоздать таргет.

## **Client analysis** 

Прежде, чем перейти к разработке модели, был проведен сравнительный анализ **ушедших клиентов** и **текущих клиентов**

Анализ нацелен на выявление ключевых показателей/флагов, поведенческих особенностей клиентов, которые не планируют долго пользоваться услугами компании. 
Клиенты были разбиты на 2 группы. Было проведено сравнение поведения клиентов, их подключенные услуги, выбранный тариф, общие затраты, ежемесячные платежи и предпочтения в выборе услуг.

На основе анализа был составлен "Портрет уходящего клиента". 

## **Preprocessing**

После объединения таблиц образовались пропуски в данных. 
Пропуски в дате окончания контракта заполнили датой выгрузки данных (2020-02-01)
Остальные недостающие данные образовались только в колонках подключенных услуг - их мы заполними флагом No

## **Features** 

Для обогащения датасета рассчитали колличество месяцев, которые клиент бы пользователем компании

Удалили неинформативные и спорные признаки - 'customerID','EndDate', 'BeginDate'. 
У нас бинарная классификация а не анализ временных рядов. Даты могут дать серьезную утечку целевого признака.
Остальные признаки коррелировали с таргетом не больше 0.5

Для решения задачи были использованы 3 модели: Decision Tree, CatBoost, Neural Net

Для Decision Tree и Нейронки - преобразовали и закодировали категориальные данные, а так же провели скалирование числовых признаков. CatBoost не нуждается в кодировании.

## **Modeling**

Для обучения, валидации и тестирования датасет был разделен на три части. 
Тк таргет не сбалансирован - при делении был использован метод стратификации. Для каждой модели был использован подбор гиперпараметров для поиска лучших. 

Результаты на тестовой выборке:

| model | ROC-AUC |
|:------|:-------:|
| CatBoost | 0.833 |
| NET model | 0.831 |
| Decision tree | 0.818 |

## **Model analysis and Conclusion**

При просмотре матрицы ошибок:
|  | 0 | 1 |
|:-:|:-:|:-:|
| **0** | 387 | 42 |
| **1** | 78 | 57 |

Чаще модель ошибается в определении, что клиент уйдет.

С точки зрения бизнеса это может означать ненужные затраты на удержание клиентов, которые и так НЕ планировали уходить. 

С точки зрения клиента - повышенное внимание с предложениями ненужных доп функций может наоборот вызвать раздражение) Но при этом вряд ли отпугнет клиента от дальнейшего использования сервиса.

Мы достигли поставленной цели точности модели в 0.78

Лучшая модель показывает результат 0.83, что довольно точно позволяет предсказать вероятность ухода клиента.

Самые важные признаки/показатели, которые указывают на вероятность ухода клиента:
- Тип оплаты контракта.
- Тип интернета
- Общие траты клиента
- Способ оплаты за услуги

Очевидно, что клиенты, которые берут оплату Раз в год или Раз в два года - намерены пользоваться сервисом дольше, чем клиенты, которые берут помесячную оплату.


